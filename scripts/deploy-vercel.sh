#!/bin/bash

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–≤–æ–¥–∞
print_header() {
    echo -e "${BLUE}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë              –î–µ–ø–ª–æ–π –Ω–∞ Vercel                                 ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
}

print_step() {
    echo -e "${YELLOW}[–®–ê–ì]${NC} $1"
}

print_success() {
    echo -e "${GREEN}‚úÖ${NC} $1"
}

print_error() {
    echo -e "${RED}‚ùå${NC} $1"
}

print_info() {
    echo -e "${BLUE}‚ÑπÔ∏è${NC} $1"
}

print_header

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Vercel CLI
print_step "–ü—Ä–æ–≤–µ—Ä–∫–∞ Vercel CLI..."

if command -v vercel &> /dev/null; then
    print_success "Vercel CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
else
    print_error "Vercel CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    print_info "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Vercel CLI: npm install -g vercel"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
print_step "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Vercel..."

if vercel whoami &> /dev/null; then
    print_success "–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Vercel"
else
    print_error "–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Vercel"
    print_info "–í—ã–ø–æ–ª–Ω–∏—Ç–µ: vercel login"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Git —Å—Ç–∞—Ç—É—Å–∞
print_step "–ü—Ä–æ–≤–µ—Ä–∫–∞ Git —Å—Ç–∞—Ç—É—Å–∞..."

if [ -d ".git" ]; then
    print_success "Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞–π–¥–µ–Ω"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    if [ -n "$(git status --porcelain)" ]; then
        print_info "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è"
        
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
        git add .
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
        git commit -m "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ Vercel - $(date)"
        
        print_success "–ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã"
    else
        print_info "–ù–µ—Ç –Ω–µ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π"
    fi
else
    print_error "Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
print_step "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."

if [ -f "vercel.json" ]; then
    print_success "vercel.json –Ω–∞–π–¥–µ–Ω"
else
    print_error "vercel.json –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

if [ -d "src/webapp" ] && [ -f "src/webapp/server.js" ]; then
    print_success "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞"
else
    print_error "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Vercel
print_step "–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."

cat > vercel-env-vars.txt << 'EOF'
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Vercel
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Vercel

NODE_ENV=production
SESSION_SECRET=your_session_secret_change_this_in_vercel_dashboard

# Bitrix24 (–∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
BITRIX24_CLIENT_ID=your_client_id
BITRIX24_CLIENT_SECRET=your_client_secret
BITRIX24_CALLBACK_URL=https://your-app.vercel.app/api/auth/bitrix24/callback

# Telegram (–∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_BOT_USERNAME=your_bot_username

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
BACKEND_URL=https://your-app.vercel.app
ALLOWED_ORIGINS=https://your-app.vercel.app
LOG_LEVEL=info
EOF

print_success "–§–∞–π–ª vercel-env-vars.txt —Å–æ–∑–¥–∞–Ω"

# –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ GitHub
print_step "–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ GitHub..."

if git push origin main; then
    print_success "–ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ GitHub"
else
    print_error "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ GitHub"
    exit 1
fi

# –î–µ–ø–ª–æ–π –Ω–∞ Vercel
print_step "–î–µ–ø–ª–æ–π –Ω–∞ Vercel..."

echo ""
print_info "–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–µ–ø–ª–æ–π –Ω–∞ Vercel..."
print_info "–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ"

# –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è
if vercel --prod; then
    print_success "–î–µ–ø–ª–æ–π –Ω–∞ Vercel –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
else
    print_error "–û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è –Ω–∞ Vercel"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
print_step "–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ..."

cat > VERCEL_SETUP_COMPLETE.md << 'EOF'
# üéâ –î–µ–ø–ª–æ–π –Ω–∞ Vercel –∑–∞–≤–µ—Ä—à–µ–Ω!

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ Vercel CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≥–æ—Ç–æ–≤
- ‚úÖ –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ GitHub

### 2. –î–µ–ø–ª–æ–π
- ‚úÖ –ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ Vercel
- ‚úÖ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
1. **–û—Ç–∫—Ä–æ–π—Ç–µ Vercel Dashboard**
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à –ø—Ä–æ–µ–∫—Ç**
3. **–û—Ç–∫—Ä–æ–π—Ç–µ "Settings" ‚Üí "Environment Variables"**
4. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ `vercel-env-vars.txt`**

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bitrix24
1. **–í–æ–π–¥–∏—Ç–µ –≤ Bitrix24** –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º"** ‚Üí **"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è"**
3. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   - **–ù–∞–∑–≤–∞–Ω–∏–µ:** `Telegram Approval Cloud`
   - **URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** `https://your-app.vercel.app`
   - **URL –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** `https://your-app.vercel.app/api/auth/bitrix24`
   - **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** CRM, –ó–∞–¥–∞—á–∏, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Bot
1. **–ù–∞–ø–∏—à–∏—Ç–µ @BotFather** –≤ Telegram
2. **–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞:** `/newbot`
3. **–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω**
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook:**
   ```bash
   curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook" \
        -H "Content-Type: application/json" \
        -d '{
          "url": "https://your-app.vercel.app/api/telegram/webhook",
          "allowed_updates": ["message", "callback_query"],
          "drop_pending_updates": true
        }'
   ```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å** —á–µ—Ä–µ–∑ Bitrix24
3. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ**
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ** –ø–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
5. **–û—Ç–≤–µ—Ç—å—Ç–µ** –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ
6. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ** –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ Bitrix24

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### Vercel Dashboard
- **–ü—Ä–æ–µ–∫—Ç:** https://vercel.com/dashboard
- **–õ–æ–≥–∏:** Vercel Dashboard ‚Üí Functions
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:** Vercel Dashboard ‚Üí Settings ‚Üí Environment Variables

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **URL:** https://your-app.vercel.app
- **Health Check:** https://your-app.vercel.app/health
- **API Status:** https://your-app.vercel.app/api/auth/status

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ Vercel Dashboard
2. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** Vercel
3. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã

---

**üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ Vercel!** üöÄ
EOF

print_success "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è VERCEL_SETUP_COMPLETE.md —Å–æ–∑–¥–∞–Ω–∞"

# –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
print_step "–î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"

echo ""
print_info "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ vercel-env-vars.txt –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ"
echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel Dashboard"
echo "3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Bitrix24 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
echo "4. –°–æ–∑–¥–∞–π—Ç–µ Telegram Bot"
echo "5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é"

echo ""
print_info "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:"
echo "- VERCEL_DEPLOY_GUIDE.md - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é"
echo "- VERCEL_SETUP_COMPLETE.md - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ"
echo "- vercel-env-vars.txt - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"

echo ""
print_success "üéâ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ Vercel!"
print_info "–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ VERCEL_SETUP_COMPLETE.md"
